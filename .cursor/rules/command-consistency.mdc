---
description:
globs:
alwaysApply: true
---

# Complete CLI Change Requirements Summary

## Core Principle
**Breaking Change**: Transform from positional arguments to flag-based commands following the pattern: `initiat <domain> <verb> --flags`

## Enhanced Configuration System

### Configuration File Structure
```yaml
# ~/.initiat/config.yaml (cross-platform compatible)
api:
  base_url: "https://www.initiat.dev"
  timeout: "30s"

auth:
  service_name: "initiat-cli"

workspace:
  default_org: "acme-corp"
  default_workspace: "production"

aliases:
  prod: "acme-corp/production"
  staging: "acme-corp/staging"
  dev: "acme-corp/development"
```

## Global Flags (Available on all commands)
```bash
--config string          # Config file path (default: ~/.initiat/config.yaml)
--api-url string         # API base URL override
--timeout duration       # API timeout override (default: 30s)
```

## Workspace Context Flags
```bash
-w, --workspace string      # Workspace name only (uses default org or explicit --org)
-W, --workspace-path string # Full org/workspace path (e.g., "acme-corp/production")
-o, --org string           # Organization slug (used with -w)
```

## Complete Command Changes

### Authentication Domain
```bash
# BEFORE: initiat auth login <email>
# AFTER:  
initiat auth login                        # Prompts for email and password
initiat auth login --email user@example.com  # Prompts for password only
initiat auth login -e user@example.com   # Prompts for password only

# Unchanged:
initiat auth logout
initiat auth status
initiat auth whoami
```

### Device Domain
```bash
# BEFORE: initiat device register <device-name>
# AFTER:
initiat device register --name "my-laptop"
initiat device register -n "my-laptop"

# Unchanged:
initiat device unregister
initiat device clear-token
initiat device list
initiat device status
```

### Workspace Domain
```bash
# BEFORE: initiat workspace init <org-slug/workspace-slug>
# AFTER:
initiat workspace init -W acme-corp/production      # Full path
initiat workspace init -o acme-corp -w production  # Org + workspace
initiat workspace init -w production               # Uses default org
initiat workspace init -W prod                     # Using alias

# Unchanged:
initiat workspace list
```

### Secret Domain
```bash
# BEFORE: initiat secret set <org-slug/workspace-slug> <KEY> <VALUE>
# AFTER:
initiat secret set -W acme-corp/production -k API_KEY -v "sk-1234"  # Full path
initiat secret set -o acme-corp -w production -k API_KEY -v "sk-1234"  # Org + workspace
initiat secret set -w production -k API_KEY -v "sk-1234"  # Uses default org
initiat secret set -W prod -k API_KEY -v "sk-1234"       # Using alias
initiat secret set -k API_KEY -v "sk-1234"               # Uses full defaults

# BEFORE: initiat secret get <org-slug/workspace-slug> <KEY>
# AFTER:
initiat secret get -W acme-corp/production -k API_KEY
initiat secret get -o acme-corp -w production -k API_KEY
initiat secret get -w production -k API_KEY
initiat secret get -W prod -k API_KEY
initiat secret get -k API_KEY

# BEFORE: initiat secret list <org-slug/workspace-slug>
# AFTER:
initiat secret list -W acme-corp/production
initiat secret list -o acme-corp -w production
initiat secret list -w production
initiat secret list -W prod
initiat secret list

# BEFORE: initiat secret delete <org-slug/workspace-slug> <KEY>
# AFTER:
initiat secret delete -W acme-corp/production -k API_KEY
initiat secret delete -o acme-corp -w production -k API_KEY
initiat secret delete -w production -k API_KEY
initiat secret delete -W prod -k API_KEY
initiat secret delete -k API_KEY
```

### Configuration Domain (Enhanced)
```bash
# Configuration management
initiat config set api.base_url "https://api.initiat.dev"
initiat config set workspace.default_org "my-company"
initiat config set workspace.default_workspace "production"
initiat config get api.base_url
initiat config show
initiat config clear workspace.default_org

# Alias management (NEW)
initiat config alias set prod "acme-corp/production"
initiat config alias set staging "acme-corp/staging"
initiat config alias list
initiat config alias remove prod
```

## Workspace Context Resolution Priority
1. **Explicit `-W/--workspace-path`**: `acme-corp/production` or alias `prod`
2. **Explicit `-o/--org` + `-w/--workspace`**: `--org acme-corp --workspace production`
3. **Default org + explicit `-w/--workspace`**: Uses config `workspace.default_org` + `--workspace production`
4. **Full defaults**: Uses config `workspace.default_org` + `workspace.default_workspace`
5. **Error**: No context available

## Flag Validation Rules
- `-W/--workspace-path` and `-w/--workspace` are mutually exclusive
- `-W/--workspace-path` and `-o/--org` are mutually exclusive
- `-w/--workspace` can be used with `-o/--org` or rely on default org

## Key Benefits
- **Consistency**: All commands follow `initiat <domain> <verb> --flags`
- **Flexibility**: Multiple ways to specify workspace context
- **Efficiency**: Defaults and aliases reduce typing
- **Cross-platform**: Uses existing proven file/keychain patterns
- **User-friendly**: Auth can prompt for credentials
- **Powerful**: Advanced config with nested structure and aliases

## Breaking Changes Summary
- **All positional arguments removed** in favor of flags
- **Auth login**: Can prompt for email/password or use `--email` flag
- **Device register**: `--name` flag required
- **All secret commands**: Workspace via flags, key/value via flags
- **Workspace init**: Workspace specification via flags
- **Enhanced config**: Nested structure with aliases support
